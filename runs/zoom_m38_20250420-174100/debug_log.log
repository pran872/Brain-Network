2025-04-20 17:41:00,131 | INFO | Job Started
2025-04-20 17:41:00,131 | INFO | Logging run: /rds/general/user/psp20/home/Brain-Network/runs/zoom_m38_20250420-174100
2025-04-20 17:41:00,131 | INFO | Config:
{
  "seed": 42,
  "run_name": "zoom_m38",
  "model_type": "zoom",
  "optimizer": "adam",
  "scheduler": "ReduceLROnPlateau",
  "criterion": "CE",
  "label_smoothing": 0.1,
  "train_split": 0.9,
  "batch_size": 256,
  "num_workers": 2,
  "lr": 0.001,
  "epochs": 50,
  "ema": false,
  "early_stopping": true,
  "min_diff": 0.001,
  "writer": true,
  "patience": 10,
  "use_flex": false,
  "use_pos_embed": true,
  "add_dropout": false,
  "mlp_end": false,
  "add_cls_token": true,
  "num_layers": 2,
  "trans_dropout_ratio": 0.0,
  "standard_scale": true,
  "transform_type": "custom",
  "downsample_fraction": 0,
  "few_shot": false,
  "attacker": "FGSM",
  "epsilon": 0.2,
  "gaussian_std": false
}
2025-04-20 17:41:00,397 | INFO | Using device: cuda
2025-04-20 17:41:00,397 | INFO | Training for 50 epochs
2025-04-20 17:41:00,397 | INFO | Debug mode: False
2025-04-20 17:41:00,397 | INFO | Downsampling by: 0
2025-04-20 17:41:01,777 | INFO | Using custom transform
2025-04-20 17:41:03,144 | INFO | Full train/val size with downsampling (0): 50000
2025-04-20 17:41:04,601 | INFO | Label smoothing: 0.1
2025-04-20 17:41:13,950 | INFO | Epoch 1: Train Loss=1.7792, Train Acc=38.30% | Val Loss=1.6655, Val Acc=45.58% | Time: 9.35s
2025-04-20 17:41:13,951 | INFO | New best model saved (val loss = 1.6655)
2025-04-20 17:41:21,744 | INFO | Epoch 2: Train Loss=1.3963, Train Acc=58.53% | Val Loss=1.3379, Val Acc=61.36% | Time: 7.79s
2025-04-20 17:41:21,746 | INFO | New best model saved (val loss = 1.3379)
2025-04-20 17:41:29,725 | INFO | Epoch 3: Train Loss=1.2059, Train Acc=67.96% | Val Loss=1.2008, Val Acc=68.12% | Time: 7.98s
2025-04-20 17:41:29,726 | INFO | New best model saved (val loss = 1.2008)
2025-04-20 17:41:37,541 | INFO | Epoch 4: Train Loss=1.0849, Train Acc=73.96% | Val Loss=1.0524, Val Acc=76.36% | Time: 7.81s
2025-04-20 17:41:37,542 | INFO | New best model saved (val loss = 1.0524)
2025-04-20 17:41:45,378 | INFO | Epoch 5: Train Loss=0.9997, Train Acc=77.89% | Val Loss=0.9896, Val Acc=78.16% | Time: 7.83s
2025-04-20 17:41:45,379 | INFO | New best model saved (val loss = 0.9896)
2025-04-20 17:41:53,305 | INFO | Epoch 6: Train Loss=0.9412, Train Acc=80.65% | Val Loss=1.1061, Val Acc=73.18% | Time: 7.92s
2025-04-20 17:42:01,133 | INFO | Epoch 7: Train Loss=0.9011, Train Acc=82.46% | Val Loss=0.9792, Val Acc=79.50% | Time: 7.83s
2025-04-20 17:42:01,134 | INFO | New best model saved (val loss = 0.9792)
2025-04-20 17:42:09,036 | INFO | Epoch 8: Train Loss=0.8659, Train Acc=83.97% | Val Loss=1.0120, Val Acc=76.88% | Time: 7.90s
2025-04-20 17:42:16,885 | INFO | Epoch 9: Train Loss=0.8432, Train Acc=85.18% | Val Loss=0.9339, Val Acc=80.96% | Time: 7.85s
2025-04-20 17:42:16,887 | INFO | New best model saved (val loss = 0.9339)
2025-04-20 17:42:24,718 | INFO | Epoch 10: Train Loss=0.8124, Train Acc=86.38% | Val Loss=0.9726, Val Acc=79.56% | Time: 7.83s
2025-04-20 17:42:32,577 | INFO | Epoch 11: Train Loss=0.7972, Train Acc=87.18% | Val Loss=0.8725, Val Acc=83.52% | Time: 7.86s
2025-04-20 17:42:32,578 | INFO | New best model saved (val loss = 0.8725)
2025-04-20 17:42:40,501 | INFO | Epoch 12: Train Loss=0.7824, Train Acc=87.82% | Val Loss=0.8255, Val Acc=85.70% | Time: 7.92s
2025-04-20 17:42:40,502 | INFO | New best model saved (val loss = 0.8255)
2025-04-20 17:42:48,393 | INFO | Epoch 13: Train Loss=0.7626, Train Acc=88.58% | Val Loss=0.8380, Val Acc=85.34% | Time: 7.89s
2025-04-20 17:42:56,260 | INFO | Epoch 14: Train Loss=0.7460, Train Acc=89.46% | Val Loss=0.8253, Val Acc=86.14% | Time: 7.86s
2025-04-20 17:42:56,261 | INFO | New best model saved (val loss = 0.8253)
2025-04-20 17:43:04,130 | INFO | Epoch 15: Train Loss=0.7380, Train Acc=89.64% | Val Loss=0.8558, Val Acc=84.66% | Time: 7.86s
2025-04-20 17:43:12,060 | INFO | Epoch 16: Train Loss=0.7307, Train Acc=90.10% | Val Loss=0.8284, Val Acc=85.80% | Time: 7.92s
2025-04-20 17:43:19,906 | INFO | Epoch 17: Train Loss=0.7160, Train Acc=90.60% | Val Loss=0.8278, Val Acc=85.56% | Time: 7.84s
2025-04-20 17:43:27,757 | INFO | Epoch 18: Train Loss=0.7088, Train Acc=90.88% | Val Loss=0.8099, Val Acc=86.80% | Time: 7.85s
2025-04-20 17:43:27,758 | INFO | New best model saved (val loss = 0.8099)
2025-04-20 17:43:35,697 | INFO | Epoch 19: Train Loss=0.7090, Train Acc=90.77% | Val Loss=0.9125, Val Acc=82.60% | Time: 7.93s
2025-04-20 17:43:43,555 | INFO | Epoch 20: Train Loss=0.6929, Train Acc=91.69% | Val Loss=0.8236, Val Acc=85.82% | Time: 7.85s
2025-04-20 17:43:51,443 | INFO | Epoch 21: Train Loss=0.6856, Train Acc=91.95% | Val Loss=0.8496, Val Acc=85.10% | Time: 7.88s
2025-04-20 17:43:59,293 | INFO | Epoch 22: Train Loss=0.6833, Train Acc=92.15% | Val Loss=0.8078, Val Acc=86.56% | Time: 7.84s
2025-04-20 17:43:59,294 | INFO | New best model saved (val loss = 0.8078)
2025-04-20 17:44:07,191 | INFO | Epoch 23: Train Loss=0.6702, Train Acc=92.62% | Val Loss=0.8066, Val Acc=86.72% | Time: 7.89s
2025-04-20 17:44:07,192 | INFO | New best model saved (val loss = 0.8066)
2025-04-20 17:44:15,050 | INFO | Epoch 24: Train Loss=0.6693, Train Acc=92.74% | Val Loss=0.7863, Val Acc=88.00% | Time: 7.85s
2025-04-20 17:44:15,051 | INFO | New best model saved (val loss = 0.7863)
2025-04-20 17:44:22,920 | INFO | Epoch 25: Train Loss=0.6589, Train Acc=93.12% | Val Loss=0.8221, Val Acc=86.16% | Time: 7.86s
2025-04-20 17:44:30,783 | INFO | Epoch 26: Train Loss=0.6549, Train Acc=93.33% | Val Loss=0.8020, Val Acc=87.36% | Time: 7.86s
2025-04-20 17:44:38,646 | INFO | Epoch 27: Train Loss=0.6508, Train Acc=93.42% | Val Loss=0.7756, Val Acc=88.46% | Time: 7.86s
2025-04-20 17:44:38,647 | INFO | New best model saved (val loss = 0.7756)
2025-04-20 17:44:46,518 | INFO | Epoch 28: Train Loss=0.6422, Train Acc=93.87% | Val Loss=0.8266, Val Acc=86.38% | Time: 7.86s
2025-04-20 17:44:54,378 | INFO | Epoch 29: Train Loss=0.6452, Train Acc=93.72% | Val Loss=0.8100, Val Acc=87.00% | Time: 7.85s
2025-04-20 17:45:02,232 | INFO | Epoch 30: Train Loss=0.6382, Train Acc=94.02% | Val Loss=0.8110, Val Acc=86.72% | Time: 7.85s
2025-04-20 17:45:10,127 | INFO | Epoch 31: Train Loss=0.6337, Train Acc=94.27% | Val Loss=0.8092, Val Acc=86.90% | Time: 7.89s
2025-04-20 17:45:18,072 | INFO | Epoch 32: Train Loss=0.5789, Train Acc=96.70% | Val Loss=0.6868, Val Acc=92.10% | Time: 7.94s
2025-04-20 17:45:18,073 | INFO | New best model saved (val loss = 0.6868)
2025-04-20 17:45:26,004 | INFO | Epoch 33: Train Loss=0.5536, Train Acc=97.82% | Val Loss=0.6970, Val Acc=92.06% | Time: 7.92s
2025-04-20 17:45:33,851 | INFO | Epoch 34: Train Loss=0.5467, Train Acc=98.13% | Val Loss=0.6989, Val Acc=92.16% | Time: 7.84s
2025-04-20 17:45:41,701 | INFO | Epoch 35: Train Loss=0.5422, Train Acc=98.36% | Val Loss=0.6848, Val Acc=92.68% | Time: 7.84s
2025-04-20 17:45:41,702 | INFO | New best model saved (val loss = 0.6848)
2025-04-20 17:45:49,565 | INFO | Epoch 36: Train Loss=0.5368, Train Acc=98.53% | Val Loss=0.6977, Val Acc=92.34% | Time: 7.85s
2025-04-20 17:45:57,411 | INFO | Epoch 37: Train Loss=0.5336, Train Acc=98.70% | Val Loss=0.6867, Val Acc=92.54% | Time: 7.84s
2025-04-20 17:46:05,252 | INFO | Epoch 38: Train Loss=0.5303, Train Acc=98.86% | Val Loss=0.6910, Val Acc=92.44% | Time: 7.83s
2025-04-20 17:46:13,123 | INFO | Epoch 39: Train Loss=0.5281, Train Acc=98.96% | Val Loss=0.6947, Val Acc=92.66% | Time: 7.86s
2025-04-20 17:46:20,979 | INFO | Epoch 40: Train Loss=0.5244, Train Acc=99.10% | Val Loss=0.7002, Val Acc=92.38% | Time: 7.85s
2025-04-20 17:46:28,888 | INFO | Epoch 41: Train Loss=0.5218, Train Acc=99.23% | Val Loss=0.6808, Val Acc=93.08% | Time: 7.90s
2025-04-20 17:46:28,889 | INFO | New best model saved (val loss = 0.6808)
2025-04-20 17:46:36,745 | INFO | Epoch 42: Train Loss=0.5204, Train Acc=99.30% | Val Loss=0.6926, Val Acc=92.72% | Time: 7.85s
2025-04-20 17:46:44,590 | INFO | Epoch 43: Train Loss=0.5212, Train Acc=99.24% | Val Loss=0.6809, Val Acc=93.14% | Time: 7.83s
2025-04-20 17:46:52,474 | INFO | Epoch 44: Train Loss=0.5190, Train Acc=99.34% | Val Loss=0.6986, Val Acc=92.56% | Time: 7.87s
2025-04-20 17:47:00,337 | INFO | Epoch 45: Train Loss=0.5204, Train Acc=99.28% | Val Loss=0.6844, Val Acc=93.10% | Time: 7.85s
2025-04-20 17:47:08,191 | INFO | Epoch 46: Train Loss=0.5196, Train Acc=99.28% | Val Loss=0.6828, Val Acc=92.90% | Time: 7.84s
2025-04-20 17:47:16,060 | INFO | Epoch 47: Train Loss=0.5194, Train Acc=99.34% | Val Loss=0.6951, Val Acc=92.60% | Time: 7.86s
2025-04-20 17:47:23,933 | INFO | Epoch 48: Train Loss=0.5193, Train Acc=99.33% | Val Loss=0.6989, Val Acc=92.32% | Time: 7.86s
2025-04-20 17:47:31,785 | INFO | Epoch 49: Train Loss=0.5197, Train Acc=99.31% | Val Loss=0.6950, Val Acc=92.70% | Time: 7.84s
2025-04-20 17:47:39,646 | INFO | Epoch 50: Train Loss=0.5189, Train Acc=99.35% | Val Loss=0.6843, Val Acc=92.96% | Time: 7.85s
2025-04-20 17:47:39,686 | INFO | Best model with lowest val loss 0.6808292388916015 at 40 epoch is saved.
2025-04-20 17:47:40,745 | ERROR | Error occured
Traceback (most recent call last):
  File "/rds/general/user/psp20/home/Brain-Network/source/simple_cnn.py", line 576, in main
    best_loss_res = test_model(
                    ^^^^^^^^^^^
  File "/rds/general/user/psp20/home/Brain-Network/source/simple_cnn.py", line 317, in test_model
    adv_images = attacker(images, labels)
                 ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/miniforge3/envs/brain-network-env/lib/python3.11/site-packages/torchattacks/attack.py", line 511, in __call__
    adv_inputs = self.forward(inputs, labels, *args, **kwargs)
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/miniforge3/envs/brain-network-env/lib/python3.11/site-packages/torchattacks/attacks/fgsm.py", line 48, in forward
    outputs = self.get_logits(images)
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/miniforge3/envs/brain-network-env/lib/python3.11/site-packages/torchattacks/attack.py", line 79, in get_logits
    logits = self.model(inputs)
             ^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/Brain-Network/source/models.py", line 258, in forward
    tokens = block(tokens, gamma)
             ^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/Brain-Network/source/zoom_att.py", line 79, in forward
    x = x + self.attn(self.norm1(x), gamma)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/Brain-Network/source/zoom_att.py", line 53, in forward
    qkv = self.qkv(x).reshape(B, N, 3, H, D // H).permute(2, 0, 3, 1, 4)
          ^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/rds/general/user/psp20/home/.local/lib/python3.11/site-packages/torch/nn/modules/linear.py", line 125, in forward
    return F.linear(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 2.00 MiB. GPU 0 has a total capacity of 44.42 GiB of which 2.12 MiB is free. Including non-PyTorch memory, this process has 44.41 GiB memory in use. Of the allocated memory 42.09 GiB is allocated by PyTorch, and 1.81 GiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
